<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CashCall — Withdraw</title>
  <meta name="description" content="Withdraw money from your CashCall wallet (demo)" />
  <style>
    /* Minimal shared styling */
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f6f9ff;color:#07112a}
    a{color:inherit;text-decoration:none}
    .container{max-width:920px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .logo{width:44px;height:44;border-radius:10px;background:linear-gradient(180deg,#2563eb,#1e40af);display:inline-flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(8,30,63,0.06);border:1px solid rgba(6,30,63,0.04)}
    h1{margin:0 0 4px;font-size:20px}
    .muted{color:#64748b}
    form{display:grid;gap:12px;margin-top:14px}
    input,select,button{padding:12px;border-radius:10px;border:1px solid #e6eefc;font-size:15px}
    .primary{background:#2563eb;color:#fff;border:0;font-weight:800}
    .small{font-size:13px;color:#64748b}
    .note{margin-top:8px;color:#334155}
    footer{margin-top:18px;text-align:center;color:#94a3b8}
    .toast{position:fixed;right:20px;bottom:20px;background:#07112a;color:#fff;padding:12px 16px;border-radius:10px;display:none}
    .toast.show{display:block}
    @media(max-width:720px){.container{padding:12px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="display:flex;gap:12px;align-items:center">
        <a href="dashboard.html" aria-label="Back to dashboard"><div class="logo">CC</div></a>
        <div>
          <h1>Withdraw Funds</h1>
          <div class="muted">Transfer wallet balance to your bank or mobile money (demo)</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <a href="dashboard.html" style="padding:8px 12px;border-radius:10px;background:#e6eefc;color:#1e40af">Back</a>
        <a href="index.html" style="padding:8px 12px;border-radius:10px;background:transparent;border:1px solid #e6eefc">Home</a>
      </div>
    </header>

    <main>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <div class="small">Available balance</div>
            <div style="font-size:22px;font-weight:800">R <span id="balance">0.00</span></div>
          </div>
          <div style="text-align:right">
            <div class="muted small">Quick tip</div>
            <div class="note">Withdrawals are simulated in this demo — integrate your PSP or bank API for production.</div>
          </div>
        </div>

        <form id="withdrawForm" aria-label="Withdraw form">
          <label>Amount to withdraw (ZAR)</label>
          <input id="withdrawAmount" type="number" min="1" step="0.01" placeholder="e.g. 150.00" required />

          <label>Destination</label>
          <select id="destType">
            <option value="bank">Bank account</option>
            <option value="mobile">Mobile money</option>
            <option value="manual">Manual (cash/payout)</option>
          </select>

          <div id="bankFields">
            <input id="bankName" type="text" placeholder="Bank name (e.g., FNB)" />
            <input id="accountNumber" type="text" placeholder="Account number" />
            <input id="accountName" type="text" placeholder="Account holder name" />
          </div>

          <div style="display:flex;gap:8px;margin-top:8px">
            <button type="submit" class="primary">Request Withdraw</button>
            <button type="button" id="cancelBtn">Cancel</button>
          </div>

          <div class="small" style="margin-top:10px">This demo immediately reduces the wallet balance and simulates a withdrawal record. In production, call your payout provider/PSP and record transaction status via webhooks.</div>
        </form>
      </div>

      <div style="height:14px"></div>

      <div class="card" id="historyCard">
        <h3 style="margin:0 0 8px">Withdrawal History (Demo)</h3>
        <div id="withdrawList" class="muted small">No withdrawals yet.</div>
      </div>
    </main>

    <footer>
      <div class="muted">© <span id="year"></span> CashCall — Demo</div>
    </footer>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    const SESSION_KEY = 'cashcall_session_v2';
    const WITHDRAW_KEY = 'cashcall_withdrawals_v1';

    function $(s){return document.querySelector(s)}
    function fmt(v){return Number(v||0).toLocaleString('en-ZA',{minimumFractionDigits:2,maximumFractionDigits:2})}

    function getSession(){return JSON.parse(localStorage.getItem(SESSION_KEY)||'{}')}
    function saveSession(s){localStorage.setItem(SESSION_KEY, JSON.stringify(s))}
    function getWithdrawals(){return JSON.parse(localStorage.getItem(WITHDRAW_KEY)||'[]')}
    function saveWithdrawals(a){localStorage.setItem(WITHDRAW_KEY, JSON.stringify(a))}

    function showToast(msg, t=2400){const el=$('#toast');el.textContent=msg;el.classList.add('show');clearTimeout(el._to);el._to=setTimeout(()=>el.classList.remove('show'),t)}

    function renderSession(){
      const s=getSession();
      $('#balance').textContent = fmt(s.balance);
    }

    function renderHistory(){
      const list=getWithdrawals();
      const out=$('#withdrawList');
      if(!list.length){out.innerHTML='No withdrawals yet.';return}
      out.innerHTML = '<ul style="padding-left:18px;margin:0">' + list.map(w=>`<li style="margin-bottom:8px">R ${fmt(w.amount)} • ${w.dest} • ${new Date(w.at).toLocaleString()}</li>`).join('') + '</ul>';
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      $('#year').textContent = new Date().getFullYear();
      // ensure demo session exists
      if(!localStorage.getItem(SESSION_KEY)){
        localStorage.setItem(SESSION_KEY, JSON.stringify({fullname:'Demo User', phone:'+27 82 000 0000', balance:420.00}));
      }
      renderSession();
      renderHistory();

      $('#destType').addEventListener('change', (e)=>{
        const v=e.target.value;
        $('#bankFields').style.display = v === 'bank' ? 'block' : (v === 'mobile' ? 'block' : 'none');
      });

      $('#withdrawForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const amt = Number($('#withdrawAmount').value);
        if(!amt || amt <= 0) return showToast('Enter a valid amount');
        const s = getSession();
        if(amt > (s.balance||0)) return showToast('Insufficient wallet balance');
        // reduce balance
        s.balance = Number((s.balance - amt).toFixed(2));
        saveSession(s);
        renderSession();
        // record withdrawal
        const destType = $('#destType').value;
        const dest = destType === 'bank' ? `${$('#bankName').value||'Bank'} • ${$('#accountNumber').value||'N/A'}` : (destType==='mobile' ? 'Mobile money' : 'Manual');
        const rec = { id: 'w' + Math.random().toString(36).slice(2,8), amount:amt, dest, at: Date.now(), status:'processing' };
        const hist = getWithdrawals(); hist.unshift(rec); saveWithdrawals(hist);
        renderHistory();
        showToast('Withdrawal requested (demo).');
        $('#withdrawAmount').value=''; $('#bankName').value=''; $('#accountNumber').value=''; $('#accountName').value='';
      });

      $('#cancelBtn').addEventListener('click', ()=>{ window.location.href = 'dashboard.html' });
    });
  </script>
</body>
</html>