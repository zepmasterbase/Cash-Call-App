<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>CashCall â€” Dashboard</title>
  <meta name="description" content="CashCall dashboard â€” wallet balance, quick actions and transaction history." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Manrope:wght@600;800&display=swap" rel="stylesheet">
  <style>
    /* Mobile-first, clean & modern */
    :root{
      --bg-1:#eef6fb;
      --bg-2:#ffffff;
      --card:#ffffff;
      --muted:#50636f;
      --accent-a:#00bcd4;
      --accent-b:#8450ff;
      --glass: rgba(255,255,255,0.8);
      --radius:14px;
      --maxw:420px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; padding:0; background: linear-gradient(180deg,var(--bg-1),var(--bg-2)); font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial; -webkit-font-smoothing:antialiased;}
    body{ padding:18px; color:#072033; -webkit-text-size-adjust:100%; }

    .wrap{ max-width:var(--maxw); margin:0 auto; }

    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px; border-radius:12px; background:var(--glass);
      border:1px solid rgba(7,32,44,0.06); box-shadow: 0 8px 30px rgba(7,30,60,0.04);
      position:sticky; top:12px; z-index:20;
    }
    .brand { display:flex; gap:12px; align-items:center; min-width:0; }
    .logo { width:44px; height:44px; border-radius:10px; display:grid; place-items:center; background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:#021026; font-weight:900; font-family:Manrope; }
    .who { min-width:0; overflow:hidden; }
    .who .hi { font-size:12px; color:var(--muted); margin:0; }
    .who .name { font-family:Manrope; font-size:15px; font-weight:800; margin:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .hdr-actions { display:flex; gap:8px; align-items:center; }
    .btn-icon { width:40px; height:40px; display:grid; place-items:center; border-radius:10px; border:1px solid rgba(7,32,44,0.04); background:transparent; cursor:pointer; font-weight:700; color:var(--muted); }
    .btn-ghost { padding:8px 12px; border-radius:10px; background:transparent; border:1px solid rgba(7,32,44,0.04); color:var(--muted); cursor:pointer; font-weight:700; }

    /* main card: balance */
    .card { margin-top:14px; background:var(--card); border-radius:14px; padding:14px; border:1px solid rgba(7,32,44,0.04); box-shadow: 0 20px 50px rgba(7,30,60,0.04); }
    .card .label { font-size:12px; color:var(--muted); }
    .balance-row { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:6px; }
    .balance { font-family:Manrope; font-size:28px; font-weight:800; color:#021026; }
    .balance-sub { font-size:12px; color:var(--muted); margin-top:4px; }

    /* actions */
    .actions { display:flex; gap:10px; margin-top:12px; }
    .action { flex:1; padding:12px 10px; border-radius:12px; text-align:center; font-weight:800; cursor:pointer; border:0; color:#021026; background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); }
    .action.ghost { background:transparent; border:1px solid rgba(7,32,44,0.06); color:var(--muted); font-weight:700; }

    /* history list */
    .section-title { margin:18px 2px 8px; font-weight:800; font-family:Manrope; font-size:14px; color:#021026; }
    .history { display:flex; flex-direction:column; gap:10px; margin-bottom:20px; }
    .tx { display:flex; justify-content:space-between; gap:12px; align-items:center; padding:12px; border-radius:12px; background:rgba(2,8,12,0.02); border:1px solid rgba(7,32,44,0.03); }
    .tx-left { display:flex; gap:10px; align-items:center; min-width:0; }
    .tx-ico { width:44px; height:44px; border-radius:10px; display:grid; place-items:center; font-weight:800; color:#021026; background:linear-gradient(135deg, rgba(0,188,212,0.08), rgba(132,80,255,0.08)); }
    .tx-title { font-weight:700; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .tx-sub { font-size:12px; color:var(--muted); margin-top:4px; }
    .tx-right { text-align:right; min-width:90px; }
    .tx-amt { font-weight:800; font-size:15px; }
    .tx-time { font-size:12px; color:var(--muted); margin-top:4px; }

    /* empty state */
    .empty { padding:18px; border-radius:12px; text-align:center; color:var(--muted); border:1px dashed rgba(7,32,44,0.03); background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.5)); }

    /* footer */
    footer{ margin-top:18px; text-align:center; font-size:13px; color:var(--muted); }

    @media (max-width:380px){
      .balance { font-size:24px; }
      .tx-right { min-width:84px; }
    }
  </style>
</head>
<body>
  <div class="wrap" role="document">
    <header role="banner" aria-label="Top bar">
      <div class="brand">
        <div class="logo" aria-hidden="true">C</div>
        <div class="who">
          <p class="hi" id="greet">Hello,</p>
          <p class="name" id="userName">User</p>
        </div>
      </div>

      <div class="hdr-actions" role="group" aria-label="Header actions">
        <button id="refreshBtn" class="btn-icon" title="Refresh" aria-label="Refresh">âŸ³</button>
        <button id="logoutBtn" class="btn-ghost" title="Log out" aria-label="Log out">Log out</button>
      </div>
    </header>

    <main>
      <section class="card" aria-labelledby="walletTitle">
        <div id="walletTitle" class="label">Wallet balance</div>
        <div class="balance-row">
          <div>
            <div id="walletCurrency" class="balance">â€”</div>
            <div id="walletSub" class="balance-sub">Available balance</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
            <a href="request.html" class="action" style="text-decoration:none;display:inline-block;padding:8px 12px;font-size:13px;">Request</a>
            <a href="pay.html" class="action ghost" style="text-decoration:none;display:inline-block;padding:8px 12px;font-size:13px;">Pay</a>
          </div>
        </div>

        <div class="actions" style="margin-top:12px;">
          <a href="withdrawal.html" class="action" style="flex:1;text-decoration:none;display:inline-block;">Withdraw</a>
          <button id="quickReceive" class="action ghost" style="flex:1;background:transparent;border:1px solid rgba(7,32,44,0.06);">Receive</button>
        </div>
      </section>

      <h2 class="section-title">Recent activity</h2>

      <section aria-live="polite">
        <div id="history" class="history" aria-label="Transaction history">
          <!-- transactions rendered here -->
        </div>

        <div id="emptyState" class="empty" hidden>
          No transactions yet. When you receive or request payments they'll show up here.
        </div>
      </section>
    </main>

    <footer>
      <div id="accountMeta" style="font-size:13px;color:var(--muted)"></div>
    </footer>
  </div>

  <script>
    /* Dashboard demo logic
       - reads session from localStorage first, then sessionStorage
       - expects keys: cashcall_token, cashcall_user, cashcall_wallet
       - transaction history stored under 'cashcall_history' (array) in localStorage
       - Logout clears the stored session and redirects to index.html
    */

    const TOKEN_KEY = 'cashcall_token';
    const USER_KEY = 'cashcall_user';
    const WALLET_KEY = 'cashcall_wallet';
    const HISTORY_KEY = 'cashcall_history';

    function readSession() {
      let token = localStorage.getItem(TOKEN_KEY);
      let user = localStorage.getItem(USER_KEY);
      let wallet = localStorage.getItem(WALLET_KEY);

      if (!token) {
        token = sessionStorage.getItem(TOKEN_KEY);
        user = sessionStorage.getItem(USER_KEY);
        wallet = sessionStorage.getItem(WALLET_KEY);
      }
      if (!token || !user || !wallet) return null;
      try {
        return {
          token,
          user: JSON.parse(user),
          wallet: JSON.parse(wallet)
        };
      } catch (err) {
        // malformed data: clear
        clearSession();
        return null;
      }
    }

    function clearSession() {
      localStorage.removeItem(TOKEN_KEY);
      localStorage.removeItem(USER_KEY);
      localStorage.removeItem(WALLET_KEY);
      sessionStorage.removeItem(TOKEN_KEY);
      sessionStorage.removeItem(USER_KEY);
      sessionStorage.removeItem(WALLET_KEY);
    }

    // Format currency nicely using Intl; fallback to plain string if unsupported
    function formatCurrency(amount, currency) {
      try {
        return new Intl.NumberFormat(undefined, { style: 'currency', currency }).format(amount);
      } catch (err) {
        return (currency ? currency + ' ' : '') + Number(amount).toFixed(2);
      }
    }

    // Render wallet and user info
    function renderHeader(session) {
      const userName = document.getElementById('userName');
      const greet = document.getElementById('greet');
      const meta = document.getElementById('accountMeta');

      userName.textContent = session.user.name || session.user.email || 'User';
      greet.textContent = 'Hello,';
      meta.textContent = (session.user.email || session.user.phone || '') + (session.user.country ? ' â€¢ ' + session.user.country.toUpperCase() : '');
    }

    function renderWallet(session) {
      const currencyEl = document.getElementById('walletCurrency');
      const walletSub = document.getElementById('walletSub');
      const wallet = session.wallet || { balance: 0, currency: 'USD' };
      currencyEl.textContent = formatCurrency(wallet.balance || 0, wallet.currency || 'USD');
      walletSub.textContent = 'Available balance â€¢ ' + (wallet.currency || 'USD');
    }

    // transactions: expected shape { id, type: 'credit'|'debit'|'request', title, subtitle, amount, currency, timestamp }
    function loadHistory() {
      try {
        const raw = localStorage.getItem(HISTORY_KEY) || '[]';
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr)) return [];
        // most recent first
        return arr.slice().reverse();
      } catch (err) {
        return [];
      }
    }

    function saveHistory(arr) {
      localStorage.setItem(HISTORY_KEY, JSON.stringify(arr || []));
    }

    function addDemoTransaction(tx) {
      // push to history in chronological order then re-render
      const cur = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
      cur.push(tx);
      saveHistory(cur);
      renderHistory();
    }

    function txIcon(type) {
      if (type === 'credit') return 'ï¼‹';
      if (type === 'debit') return 'ï¼';
      if (type === 'request') return 'ðŸ”—';
      return 'â€¢';
    }

    function renderHistory() {
      const list = document.getElementById('history');
      const emptyState = document.getElementById('emptyState');
      list.innerHTML = '';

      const txs = loadHistory();
      if (!txs.length) {
        emptyState.hidden = false;
        return;
      } else {
        emptyState.hidden = true;
      }

      txs.forEach(tx => {
        const el = document.createElement('div');
        el.className = 'tx';
        el.innerHTML = `
          <div class="tx-left">
            <div class="tx-ico" aria-hidden="true">${txIcon(tx.type)}</div>
            <div style="min-width:0">
              <div class="tx-title">${escapeHtml(tx.title)}</div>
              <div class="tx-sub">${escapeHtml(tx.subtitle || '')}</div>
            </div>
          </div>
          <div class="tx-right">
            <div class="tx-amt">${formatCurrency(tx.amount, tx.currency)}</div>
            <div class="tx-time">${timeAgo(new Date(tx.timestamp))}</div>
          </div>
        `;
        list.appendChild(el);
      });
    }

    // small helper to render human-friendly time
    function timeAgo(date) {
      const diff = Date.now() - date.getTime();
      const s = Math.floor(diff / 1000);
      if (s < 60) return s + 's';
      const m = Math.floor(s / 60);
      if (m < 60) return m + 'm';
      const h = Math.floor(m / 60);
      if (h < 24) return h + 'h';
      const d = Math.floor(h / 24);
      return d + 'd';
    }

    // prevent XSS in inserted text
    function escapeHtml(s) {
      if (!s) return '';
      return String(s).replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // init dashboard
    (function init(){
      const s = readSession();
      if (!s) {
        // not logged in â€” send to index or login
        window.location.href = 'index.html';
        return;
      }

      renderHeader(s);
      renderWallet(s);
      renderHistory();

      // Demo: wiring buttons
      document.getElementById('refreshBtn').addEventListener('click', () => {
        // in a real app you'd re-fetch wallet & history; here we re-read localStorage
        renderWallet(readSession() || s);
        renderHistory();
      });

      document.getElementById('logoutBtn').addEventListener('click', () => {
        clearSession();
        // redirect to index.html as requested
        window.location.href = 'index.html';
      });

      document.getElementById('quickReceive').addEventListener('click', () => {
        // Demo quick receive: add a small credit to history & update wallet balance
        const wallet = (readSession() && readSession().wallet) || { balance: 0, currency: 'USD' };
        const amount = 50; // demo amount
        const tx = {
          id: 'tx_' + Math.random().toString(36).slice(2),
          type: 'credit',
          title: 'Quick receive',
          subtitle: 'Demo incoming payment',
          amount,
          currency: wallet.currency,
          timestamp: new Date().toISOString()
        };
        addDemoTransaction(tx);

        // update stored wallet balance
        const session = readSession();
        if (session) {
          session.wallet.balance = (Number(session.wallet.balance) || 0) + amount;
          // persist to whichever storage holds the session
          if (localStorage.getItem(TOKEN_KEY)) {
            localStorage.setItem(WALLET_KEY, JSON.stringify(session.wallet));
            localStorage.setItem(USER_KEY, JSON.stringify(session.user));
          } else {
            sessionStorage.setItem(WALLET_KEY, JSON.stringify(session.wallet));
            sessionStorage.setItem(USER_KEY, JSON.stringify(session.user));
          }
          // re-render
          renderWallet(session);
          renderHistory();
        }
      });

      // example: if no history exists, seed a lightweight demo (optional)
      if (!loadHistory().length) {
        // seed a tiny demo transaction so the UI doesn't look empty (comment out if undesired)
        const seed = {
          id: 'seed_' + Date.now(),
          type: 'credit',
          title: 'Welcome bonus',
          subtitle: 'Thanks for signing up',
          amount: 10,
          currency: (s.wallet && s.wallet.currency) || 'USD',
          timestamp: new Date().toISOString()
        };
        saveHistory([seed]);
        renderHistory();
      }

      // hook up anchor links for request/pay/withdrawal to be naturally navigable
      // (they are normal anchors in markup)
    })();
  </script>
</body>
</html>