<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>CashCall ‚Äî Sign up</title>
  <meta name="description" content="Create a CashCall account ‚Äî request payments quickly and securely." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Manrope:wght@600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-1:#eaf6ff; --bg-2:#f7fbff; --muted:#4b6272;
      --accent-a:#00bcd4; --accent-b:#8450ff; --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; width:100%; margin:0; padding:0; overflow-x:hidden;}
    body{
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#06202b;
      padding:18px 14px;
      -webkit-font-smoothing:antialiased;
    }
    .wrap{ max-width:420px; margin:0 auto; }

    header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; border-radius:12px; background: rgba(255,255,255,0.7); border:1px solid rgba(6,32,44,0.06); box-shadow: 0 6px 20px rgba(6,32,44,0.04); position:sticky; top:12px; z-index:40; margin-bottom:14px; }
    .brand{ display:flex; gap:10px; align-items:center; min-width:0; }
    .logo-wrap{ width:44px; height:44px; display:grid; place-items:center; flex:0 0 44px; }
    .logo-svg{ width:40px; height:40px; display:block; }
    .title{ font-family:Manrope,Inter; font-weight:800; font-size:16px; background-image:linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:transparent; -webkit-background-clip:text; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .hdr-actions{ display:flex; gap:8px; align-items:center; }
    .primary-btn{ padding:8px 12px; border-radius:10px; font-weight:800; background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:#021026; border:0; cursor:pointer; }

    main{ display:flex; flex-direction:column; gap:12px; }
    .hero-title{ font-family:Manrope; font-size:22px; margin:4px 0 0; color:#06202b; }
    .lead{ color:var(--muted); font-size:14px; margin:0; }

    .card{ margin-top:6px; border-radius:12px; padding:14px; background: rgba(255,255,255,0.95); border:1px solid rgba(6,32,44,0.04); box-shadow: 0 14px 40px rgba(4,18,30,0.04); }
    .form-row{ display:flex; flex-direction:column; gap:8px; margin-bottom:8px; }
    label{ font-size:13px; color:#274048; font-weight:600; }
    input[type="text"], input[type="email"], input[type="password"], select{
      padding:12px; border-radius:10px; border:1px solid rgba(6,32,44,0.06); background:transparent; font-size:15px; color:#06202b;
    }
    .hint{ font-size:12px; color:var(--muted); }

    .pw-toggle{ position:relative; display:flex; align-items:center; }
    .pw-toggle button{ position:absolute; right:8px; top:8px; border:0; background:transparent; padding:6px; cursor:pointer; color:var(--muted); }

    .submit-row{ display:flex; gap:10px; margin-top:8px; }
    .submit{ flex:1; padding:12px; border-radius:10px; border:0; font-weight:800; background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:#021026; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; gap:8px; }
    .alt{ flex:1; padding:12px; border-radius:10px; border:1px solid rgba(6,32,44,0.06); background:transparent; color:var(--muted); cursor:pointer; font-weight:700; }

    .divider{ text-align:center; color:var(--muted); font-size:13px; margin:8px 0; }

    .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:22px; background:#021026; color:#eafaff; padding:10px 14px; border-radius:10px; box-shadow:0 8px 30px rgba(2,8,20,0.3); display:none; z-index:60; font-weight:700; }

    footer{ margin-top:12px; color:var(--muted); text-align:center; font-size:13px; }

    @media (max-width:380px){ .hero-title{ font-size:20px } }
  </style>
</head>
<body>
  <div class="wrap">
    <header role="banner" aria-label="Top navigation">
      <div class="brand">
        <div class="logo-wrap" aria-hidden="true">
          <svg class="logo-svg" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="CashCall logo">
            <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0%" stop-color="#00bcd4"/><stop offset="100%" stop-color="#8450ff"/></linearGradient></defs>
            <g transform="translate(10,10)"><path d="M50 10 C30 10 14 26 14 46 C14 66 30 82 50 82 C70 82 86 66 86 46 C86 36 82 27 76 20" fill="none" stroke="url(#g1)" stroke-width="9" stroke-linecap="round" stroke-linejoin="round" opacity="0.16"/><path d="M50 10 C30 10 14 26 14 46 C14 66 30 82 50 82 C70 82 86 66 86 46 C86 36 82 27 76 20" fill="none" stroke="url(#g1)" stroke-width="9" stroke-linecap="round" stroke-linejoin="round"/></g>
          </svg>
        </div>
        <div class="title">CashCall</div>
      </div>

      <div class="hdr-actions">
        <button class="primary-btn" onclick="location.href='login.html'">Log in</button>
      </div>
    </header>

    <main>
      <div>
        <div class="hero-title">Create your CashCall account</div>
        <p class="lead">Sign up to send and receive payments quickly. No merchant setup required.</p>
      </div>

      <section class="card" aria-labelledby="signup-form">
        <form id="signupForm" autocomplete="on" novalidate>
          <div class="form-row">
            <label for="fullName">Full name</label>
            <input id="fullName" name="name" type="text" placeholder="Your name" required aria-describedby="nameHint">
            <div id="nameHint" class="hint">The name shown on receipts.</div>
          </div>

          <div class="form-row">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="you@example.com" required aria-describedby="emailHint">
            <div id="emailHint" class="hint">We'll send a verification link.</div>
          </div>

          <div class="form-row">
            <label for="phone">Phone number</label>
            <input id="phone" name="phone" type="text" placeholder="+234 80 0000 0000" inputmode="tel" required aria-describedby="phoneHint">
            <div id="phoneHint" class="hint">Use the number you'll receive requests on.</div>
          </div>

          <div class="form-row">
            <label for="country">Country</label>
            <select id="country" name="country" required aria-describedby="countryHint">
              <option value="ng" data-default-currency="NGN">Nigeria</option>
              <option value="za" data-default-currency="ZAR">South Africa</option>
              <option value="gh" data-default-currency="GHS">Ghana</option>
            </select>
            <div id="countryHint" class="hint">Choose where you primarily operate.</div>
          </div>

          <div class="form-row">
            <label for="currency">Currency (wallet)</label>
            <select id="currency" name="currency" required aria-describedby="currencyHint">
              <option value="NGN">Naira (NGN)</option>
              <option value="ZAR">Rand (ZAR)</option>
              <option value="GHS">Cedi (GHS)</option>
              <option value="USD">US Dollar (USD)</option>
            </select>
            <div id="currencyHint" class="hint">Default picked from your country but editable.</div>
          </div>

          <div class="form-row pw-toggle">
            <label for="password">Password</label>
            <input id="password" name="password" type="password" placeholder="Create a password (min 8 chars)" minlength="8" required aria-describedby="pwHint">
            <button type="button" id="togglePw" aria-label="Show password">üëÅÔ∏è</button>
            <div id="pwHint" class="hint">At least 8 characters; use letters & numbers.</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center;margin-top:6px;margin-bottom:6px;">
            <input id="remember" type="checkbox" checked aria-label="Remember on this device">
            <label for="remember" style="font-size:13px;color:var(--muted);">Remember this device (stay signed in)</label>
          </div>

          <div style="display:flex;gap:8px;margin-bottom:8px;">
            <input id="tos" name="tos" type="checkbox" required>
            <label for="tos" style="font-size:13px;color:var(--muted);">I agree to the <a href="#" style="color:var(--accent-a);text-decoration:none;">Terms</a> & <a href="#" style="color:var(--accent-a);">Privacy</a></label>
          </div>

          <div class="submit-row">
            <button type="submit" class="submit" id="submitBtn">
              <span id="btnLabel">Create account</span>
              <span id="spinner" style="display:none">‚è≥</span>
            </button>
            <button type="button" class="alt" onclick="location.href='login.html'">Have an account?</button>
          </div>

          <div class="divider">or sign up with</div>

          <div style="display:flex;gap:10px;margin-top:6px;">
            <button type="button" class="primary-btn" style="flex:1;background:transparent;border:1px solid rgba(6,32,44,0.04);color:var(--muted)" onclick="alert('Continue with Google (demo)')">Google</button>
            <button type="button" class="primary-btn" style="flex:1;background:transparent;border:1px solid rgba(6,32,44,0.04);color:var(--muted)" onclick="alert('Continue with Apple (demo)')">Apple</button>
          </div>
        </form>
      </section>

      <footer>By creating an account you accept CashCall terms. <br>Need help? <a href="#" style="color:var(--accent-a);">Contact support</a></footer>
    </main>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // Storage keys (dashboard reads these)
    const TOKEN_KEY = 'cashcall_token';
    const USER_KEY = 'cashcall_user';
    const WALLET_KEY = 'cashcall_wallet';
    const EXPIRY_KEY = 'cashcall_token_expiry_ms'; // optional

    // Country -> currency map
    const countryToCurrency = { ng: 'NGN', za: 'ZAR', gh: 'GHS' };

    // Basic UI references
    const form = document.getElementById('signupForm');
    const countryEl = document.getElementById('country');
    const currencyEl = document.getElementById('currency');
    const pwEl = document.getElementById('password');
    const togglePw = document.getElementById('togglePw');
    const btn = document.getElementById('submitBtn');
    const btnLabel = document.getElementById('btnLabel');
    const spinner = document.getElementById('spinner');
    const toast = document.getElementById('toast');

    // helper: show a short toast
    function showToast(msg, timeout = 2500) {
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', timeout);
    }

    // password toggle
    togglePw.addEventListener('click', () => {
      const isPwd = pwEl.type === 'password';
      pwEl.type = isPwd ? 'text' : 'password';
      togglePw.textContent = isPwd ? 'üôà' : 'üëÅÔ∏è';
      togglePw.setAttribute('aria-pressed', isPwd ? 'true' : 'false');
    });

    // country -> currency auto default (unless user changed currency manually)
    let currencyUserChanged = false;
    countryEl.addEventListener('change', (e) => {
      const def = countryToCurrency[e.target.value] || 'USD';
      if (!currencyUserChanged) currencyEl.value = def;
    });
    currencyEl.addEventListener('change', () => currencyUserChanged = true);

    // spinner toggle helpers
    function setLoading(yes) {
      btn.disabled = yes;
      if (yes) { spinner.style.display = 'inline'; btnLabel.textContent = 'Creating account...'; }
      else { spinner.style.display = 'none'; btnLabel.textContent = 'Create account'; }
    }

    // tiny token generator (demo fallback only)
    function makeToken() {
      return 'tok_' + Math.random().toString(36).slice(2) + Date.now().toString(36);
    }

    // persist session (remember -> localStorage, else sessionStorage)
    function persistSession({ token, user, wallet, remember }) {
      const target = remember ? localStorage : sessionStorage;
      const other = remember ? sessionStorage : localStorage;

      // clear other storage to avoid ambiguity
      other.removeItem(TOKEN_KEY);
      other.removeItem(USER_KEY);
      other.removeItem(WALLET_KEY);
      other.removeItem(EXPIRY_KEY);

      target.setItem(TOKEN_KEY, token);
      target.setItem(USER_KEY, JSON.stringify(user));
      target.setItem(WALLET_KEY, JSON.stringify(wallet));

      if (!remember) {
        const expiry = Date.now() + (24 * 60 * 60 * 1000); // example TTL 24h
        target.setItem(EXPIRY_KEY, String(expiry));
      } else {
        target.removeItem(EXPIRY_KEY);
      }
    }

    // demoSignup: fallback when no real API is available
    async function demoSignup(payload) {
      await new Promise(r => setTimeout(r, 450));
      if (!payload.email || !payload.password) throw new Error('Missing required fields');

      const user = {
        id: 'user_' + Math.random().toString(36).slice(2),
        name: payload.name,
        email: payload.email.toLowerCase(),
        phone: payload.phone,
        country: payload.country
      };

      const wallet = {
        userId: user.id,
        currency: payload.currency,
        balance: 0.00,
        createdAt: new Date().toISOString()
      };

      const token = makeToken();
      return { token, user, wallet };
    }

    // try to call a real API endpoint; if it fails fallback to demoSignup
    async function signupRequest(payload) {
      // Try real backend first
      try {
        const resp = await fetch('/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        if (!resp.ok) {
          // If server returns 4xx/5xx, try to parse message then fallback
          let txt = await resp.text().catch(() => null);
          throw new Error(txt || `Signup failed: ${resp.status}`);
        }

        // expect JSON: { token, user, wallet }
        const json = await resp.json();
        if (!json || !json.token || !json.user || !json.wallet) {
          throw new Error('Invalid server response');
        }
        return json;
      } catch (err) {
        // Fallback to demo for local testing
        console.warn('Signup API failed ‚Äî falling back to demoSignup. Error:', err);
        return demoSignup(payload);
      }
    }

    // form submission handling
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // gather
      const name = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const phone = document.getElementById('phone').value.trim();
      const country = countryEl.value;
      const currency = currencyEl.value;
      const password = document.getElementById('password').value;
      const remember = document.getElementById('remember').checked;
      const tos = document.getElementById('tos').checked;

      if (!tos) {
        showToast('Please accept Terms & Privacy');
        return;
      }

      const payload = { name, email, phone, country, currency, password };

      setLoading(true);
      try {
        const result = await signupRequest(payload);

        // persist session and redirect
        persistSession({ token: result.token, user: result.user, wallet: result.wallet, remember });

        // small success message then redirect
        showToast('Account created ‚Äî redirecting...');
        setTimeout(() => { window.location.href = 'dashboard.html'; }, 700);
      } catch (err) {
        console.error('signup error', err);
        showToast(err.message || 'Signup failed');
      } finally {
        setLoading(false);
      }
    });

    // set initial currency default from country on load
    (function initDefaults() {
      const def = countryToCurrency[countryEl.value] || 'USD';
      currencyEl.value = def;
    })();
  </script>
</body>
</html>