<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CashCall — Request Money</title>
  <meta name="description" content="Create payment requests in CashCall (demo)" />
  <style>
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f7fafc;color:#07112a}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
    .logo{width:44px;height:44;border-radius:10px;background:linear-gradient(180deg,#2563eb,#1e40af);display:inline-flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .card{background:#fff;padding:18px;border-radius:12px;border:1px solid rgba(6,30,63,0.04);box-shadow:0 8px 30px rgba(8,30,63,0.04)}
    h1{margin:0 0 6px}
    .muted{color:#64748b}
    form{display:grid;gap:12px;margin-top:12px}
    input,textarea,select,button{padding:12px;border-radius:10px;border:1px solid #e6eefc;font-size:15px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .primary{background:#2563eb;color:#fff;border:0;font-weight:800}
    .ghost{background:transparent;border:1px solid #e6eefc}
    .muted-2{color:#94a3b8;font-size:13px}
    .small{font-size:13px;color:#64748b}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;gap:12px;align-items:center">
        <a href="dashboard.html" aria-label="Back to dashboard"><div class="logo">CC</div></a>
        <div>
          <h1>Request Money</h1>
          <div class="muted">Create a payment request — send to a phone number or generate a shareable link (demo).</div>
        </div>
      </div>
      <nav style="display:flex;gap:8px">
        <a href="dashboard.html" class="ghost" style="padding:10px 12px;border-radius:10px">Dashboard</a>
        <a href="pay.html" class="ghost" style="padding:10px 12px;border-radius:10px">Pay</a>
      </nav>
    </header>

    <main class="grid">
      <section class="card">
        <h2 style="margin:0 0 8px">New Request</h2>
        <form id="reqForm">
          <label>Recipient phone (include country code)</label>
          <input id="phone" type="tel" placeholder="+27 82 123 4567" required />

          <label>Amount (ZAR)</label>
          <input id="amount" type="number" min="1" step="0.01" placeholder="e.g. 120.00" required />

          <label>Reference / Note</label>
          <input id="note" type="text" placeholder="e.g., Dinner split, Invoice #123" />

          <label>
            <input id="notifySms" type="checkbox" checked /> Send SMS notification to recipient (demo: simulated)
          </label>

          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="primary" type="submit">Create Request & Generate Link</button>
            <button type="button" id="resetBtn" class="ghost">Reset</button>
          </div>
        </form>

        <div id="linkBox" style="margin-top:14px;display:none">
          <div class="muted">Share this link with the payer:</div>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <input id="payLink" readonly style="flex:1;padding:10px;border-radius:10px;border:1px solid #e6eefc;background:#fbfdff" />
            <button id="copyBtn" class="ghost">Copy</button>
          </div>
          <div class="small" style="margin-top:8px;color:#334155">Tip: the link is simulated for demo. In production, the link would be a secure PSP/Checkout URL or an app deep link.</div>
        </div>
      </section>

      <aside>
        <div class="card">
          <h3 style="margin:0 0 8px">Recent Requests</h3>
          <div id="recent" class="small muted">No requests yet.</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 style="margin:0 0 8px">Group Split (Optional)</h3>
          <div class="small muted">Split an amount among several recipients and generate per-person links in the future. Demo supports simple equal split preview.</div>
          <label style="margin-top:10px">Group size</label>
          <input id="groupSize" type="number" min="2" max="20" value="2" />
          <button id="previewSplit" class="primary" style="margin-top:10px">Preview Equal Split</button>
          <div id="splitPreview" style="margin-top:10px" class="small muted">—</div>
        </div>
      </aside>
    </main>

    <footer style="margin-top:18px;text-align:center;color:#94a3b8">© <span id="year"></span> CashCall — Demo</footer>
  </div>

  <div id="toast" style="position:fixed;right:18px;bottom:18px;background:#07112a;color:#fff;padding:12px 14px;border-radius:10px;display:none"></div>

  <script>
    const STORAGE_KEY = 'cashcall_requests_v2';
    const SESSION_KEY = 'cashcall_session_v2';
    const $ = s => document.querySelector(s);
    const fmt = v => Number(v||0).toLocaleString('en-ZA',{minimumFractionDigits:2,maximumFractionDigits:2});
    function showToast(msg,t=2400){const el=$('#toast');el.textContent=msg;el.style.display='block';clearTimeout(el._to);el._to=setTimeout(()=>el.style.display='none',t)}

    function loadRequests(){return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')}
    function saveRequests(a){localStorage.setItem(STORAGE_KEY, JSON.stringify(a))}
    function newId(){return 'r'+Math.random().toString(36).slice(2,9)}

    document.addEventListener('DOMContentLoaded', ()=>{
      $('#year').textContent = new Date().getFullYear();
      if(!localStorage.getItem(SESSION_KEY)){ localStorage.setItem(SESSION_KEY, JSON.stringify({fullname:'Demo User',phone:'+27 82 000 0000',balance:420.00})); }
      renderRecent();

      $('#reqForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const phone = $('#phone').value.trim();
        const amount = Number($('#amount').value);
        const note = $('#note').value.trim();
        const notify = $('#notifySms').checked;
        if(!/^\+?\d{7,15}$/.test(phone)) return showToast('Enter a valid phone including country code.');
        if(!amount || amount <= 0) return showToast('Enter a valid amount');

        const req = { id:newId(), toPhone:phone, toName:'', amount:Number(amount.toFixed(2)), currency:'ZAR', note, status:'pending', createdAt: Date.now() };
        const list = loadRequests(); list.unshift(req); saveRequests(list);
        // generate a simulated link - include id so pay page can read it
        const link = `${location.origin}${location.pathname.replace(/request\\.html.*$/,'') || '/'}pay.html?req=${req.id}`;
        $('#payLink').value = link;
        $('#linkBox').style.display = 'block';
        if(notify) showToast('Request created and SMS simulated (demo).');
        renderRecent();
      });

      $('#resetBtn').addEventListener('click', ()=> { $('#phone').value=''; $('#amount').value=''; $('#note').value=''; $('#linkBox').style.display='none'; });

      $('#copyBtn').addEventListener('click', ()=>{
        $('#payLink').select();
        document.execCommand('copy');
        showToast('Link copied to clipboard');
      });

      $('#previewSplit').addEventListener('click', ()=>{
        const amt = Number($('#amount').value || 0);
        const n = Number($('#groupSize').value || 2);
        if(!amt || amt <= 0) return showToast('Enter amount to preview split');
        if(n < 2) return showToast('Group size must be at least 2');
        const each = (amt / n).toFixed(2);
        $('#splitPreview').textContent = `Each person pays R ${Number(each).toLocaleString('en-ZA',{minimumFractionDigits:2})}`;
      });
    });

    function renderRecent(){
      const list = loadRequests();
      const out = $('#recent');
      if(!list.length) { out.textContent = 'No requests yet.'; return }
      out.innerHTML = '<ul style="padding-left:18px;margin:0">' + list.slice(0,6).map(r=>`<li style="margin-bottom:8px">R ${fmt(r.amount)} • ${r.toPhone} • ${r.note || '—'} • ${new Date(r.createdAt).toLocaleString()}</li>`).join('') + '</ul>';
    }
  </script>
</body>
</html>